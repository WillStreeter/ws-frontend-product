"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var reselect_1 = require("reselect");
var GarmentActionTypes = require("../../../../business-layer/shared-types/actions/garment.action.types");
exports.initialState = {
    ids: [],
    entities: {},
    currentSubSet: [],
    currentCollectionId: ''
};
function reducer(state, action) {
    if (state === void 0) { state = exports.initialState; }
    switch (action.type) {
        case GarmentActionTypes.FETCH_GARMENT_COLLECTION_SUCCESS: {
            console.log('  reducer FETCH_GARMENT_COLLECTION_SUCCESS', action.payload);
            if (action.payload) {
                var garmentCollection = {};
                garmentCollection.id = '' + state.ids.length + Math.floor(Math.random() * (100 - 1)) + 1,
                    garmentCollection.products = action.payload;
                if (state.ids.indexOf(garmentCollection.id) > -1) {
                    return state;
                }
                state = Object.assign({
                    currentSubSet: state.currentSubSet,
                    ids: state.ids.concat([garmentCollection.id]),
                    entities: Object.assign({}, state.entities, (_a = {},
                        _a[garmentCollection.id] = garmentCollection,
                        _a)),
                    currentCollectionId: garmentCollection.id,
                });
            }
            return state;
        }
        case GarmentActionTypes.UPDATE_SORTED_COLLECTION: {
            if (action.payload) {
                var garmentCollection = {};
                var garmentSorted = (action.payload);
                garmentCollection.id = garmentSorted.collectionId;
                garmentCollection.products = (garmentSorted.products).slice();
                console.log('  UPDATE_SORTED_COLLECTION garmentCollection ', garmentCollection);
                console.log('  before state.entities[ garmentCollection.id] ', state.entities[garmentCollection.id]);
                state = Object.assign({
                    currentSubSet: state.currentSubSet,
                    ids: state.ids,
                    entities: Object.assign({}, state.entities, (_b = {},
                        _b[garmentCollection.id] = garmentCollection,
                        _b)),
                    currentCollectionId: state.currentCollectionId
                });
                console.log('  UPDATE_SORTED_COLLECTION  state .entities[ garmentCollection.id] ', state.entities[garmentCollection.id]);
            }
            return state;
        }
        case GarmentActionTypes.UPDATE_GARMENT_IN_COLLECTION_SUCCESS: {
            if (action.payload) {
                var garmentUpdate_1 = (action.payload);
                var sortedCollection = state.entities[garmentUpdate_1.collectionId];
                sortedCollection.products = sortedCollection.products.map(function (product) {
                    if (product.id === garmentUpdate_1.product.id) {
                        product = garmentUpdate_1.product;
                    }
                    return product;
                });
                state.entities = Object.assign({}, state.entities, (_c = {},
                    _c[sortedCollection.id] = sortedCollection,
                    _c));
            }
            return state;
        }
        case GarmentActionTypes.ADD_GARMENT_TO_COLLECTION_SUCCESS: {
            if (action.payload) {
                var garmentToAdd = (action.payload);
                var collectionAddingTo = state.entities[garmentToAdd.collectionId];
                collectionAddingTo.products.push(garmentToAdd.product);
                state.entities = Object.assign({}, state.entities, (_d = {},
                    _d[collectionAddingTo.id] = collectionAddingTo,
                    _d));
            }
            return state;
        }
        default: {
            return state;
        }
    }
    var _a, _b, _c, _d;
}
exports.reducer = reducer;
exports.getEntities = function (state) { return state.entities; };
exports.getIds = function (state) { return state.ids; };
exports.getCurrentCollectionId = function (state) { return state.currentCollectionId; };
exports.getCurrentSubSet = function (state) { return state.currentSubSet; };
exports.getCurrentGarmentCollection = reselect_1.createSelector(exports.getEntities, exports.getCurrentCollectionId, function (entities, currentCollectionId) {
    return entities[currentCollectionId];
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kYXRhLWxheWVyL25ncngtZGF0YS9yZWR1Y2Vycy9nYXJtZW50L2dhcm1lbnQucmVkdWNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHFDQUEwQztBQU0xQyx5R0FBMkc7QUFTOUYsUUFBQSxZQUFZLEdBQVU7SUFDakMsR0FBRyxFQUFFLEVBQUU7SUFDUCxRQUFRLEVBQUUsRUFBRTtJQUNaLGFBQWEsRUFBQyxFQUFFO0lBQ2hCLG1CQUFtQixFQUFDLEVBQUU7Q0FDdkIsQ0FBQztBQUVGLGlCQUF3QixLQUFvQixFQUFFLE1BQThCO0lBQXBELHNCQUFBLEVBQUEsNEJBQW9CO0lBQzFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2xCLEtBQUssa0JBQWtCLENBQUMsZ0NBQWdDLEVBQUMsQ0FBQztZQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUM3RSxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDaEIsSUFBSyxpQkFBaUIsR0FBa0QsRUFBRSxDQUFDO2dCQUMzRSxpQkFBaUIsQ0FBQyxFQUFFLEdBQUMsRUFBRSxHQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBQztvQkFDbkYsaUJBQWlCLENBQUMsUUFBUSxHQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7Z0JBQzFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDakQsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDZixDQUFDO2dCQUVGLEtB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QUM1SCxNQUFNLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDdkMsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiYXBwL2RhdGEtbGF5ZXIvbmdyeC1kYXRhL3JlZHVjZXJzL2dhcm1lbnQvZ2FybWVudC5yZWR1Y2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VsZWN0b3IgfSBmcm9tICdyZXNlbGVjdCc7XG5pbXBvcnQgeyBHYXJtZW50TW9kZWwsXG4gICAgICAgICBHYXJtZW50QWRkTW9kZWwsXG4gICAgICAgICBHYXJtZW50U29ydE1vZGVsLFxuICAgICAgICAgR2FybWVudENvbGxlY3Rpb25Nb2RlbH0gZnJvbSAnLi4vLi4vLi4vLi4vYnVzaW5lc3MtbGF5ZXIvbW9kZWxzJztcbmltcG9ydCAqIGFzIGdhcm1lbnRBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvZ2FybWVudC5hY3Rpb25zJztcbmltcG9ydCAqIGFzIEdhcm1lbnRBY3Rpb25UeXBlcyBmcm9tICcuLi8uLi8uLi8uLi9idXNpbmVzcy1sYXllci9zaGFyZWQtdHlwZXMvYWN0aW9ucy9nYXJtZW50LmFjdGlvbi50eXBlcyc7XG5cbmV4cG9ydCAgaW50ZXJmYWNlIFN0YXRlIHtcbiAgaWRzOiBzdHJpbmdbXTtcbiAgZW50aXRpZXM6IHsgW2lkOiBzdHJpbmddOiBHYXJtZW50Q29sbGVjdGlvbk1vZGVsIH07XG4gIGN1cnJlbnRTdWJTZXQ6R2FybWVudE1vZGVsW107XG4gIGN1cnJlbnRDb2xsZWN0aW9uSWQ6c3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgaW5pdGlhbFN0YXRlOiBTdGF0ZSA9IHtcbiAgaWRzOiBbXSxcbiAgZW50aXRpZXM6IHt9LFxuICBjdXJyZW50U3ViU2V0OltdLFxuICBjdXJyZW50Q29sbGVjdGlvbklkOicnXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcmVkdWNlcihzdGF0ZSA9IGluaXRpYWxTdGF0ZSwgYWN0aW9uOiBnYXJtZW50QWN0aW9ucy5BY3Rpb25zKTogU3RhdGUge1xuICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICBjYXNlIEdhcm1lbnRBY3Rpb25UeXBlcy5GRVRDSF9HQVJNRU5UX0NPTExFQ1RJT05fU1VDQ0VTUzp7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgIHJlZHVjZXIgRkVUQ0hfR0FSTUVOVF9DT0xMRUNUSU9OX1NVQ0NFU1MnLCBhY3Rpb24ucGF5bG9hZClcbiAgICAgICAgICBpZihhY3Rpb24ucGF5bG9hZCkge1xuICAgICAgICAgICAgICBsZXQgIGdhcm1lbnRDb2xsZWN0aW9uOkdhcm1lbnRDb2xsZWN0aW9uTW9kZWwgPSA8R2FybWVudENvbGxlY3Rpb25Nb2RlbD57fTtcbiAgICAgICAgICAgICAgZ2FybWVudENvbGxlY3Rpb24uaWQ9Jycrc3RhdGUuaWRzLmxlbmd0aCArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAxKSkgKzEsXG4gICAgICAgICAgICAgIGdhcm1lbnRDb2xsZWN0aW9uLnByb2R1Y3RzPWFjdGlvbi5wYXlsb2FkO1xuICAgICAgICAgICAgICBpZiAoc3RhdGUuaWRzLmluZGV4T2YoZ2FybWVudENvbGxlY3Rpb24uaWQpID4gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIHN0YXRlID0gT2JqZWN0LmFzc2lnbigge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJTZXQ6c3RhdGUuY3VycmVudFN1YlNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHM6IFsgLi4uc3RhdGUuaWRzLCBnYXJtZW50Q29sbGVjdGlvbi5pZCBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0aWVzOiBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZS5lbnRpdGllcywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dhcm1lbnRDb2xsZWN0aW9uLmlkXTogZ2FybWVudENvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sbGVjdGlvbklkOmdhcm1lbnRDb2xsZWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgfVxuXG4gICAgICBjYXNlIEdhcm1lbnRBY3Rpb25UeXBlcy5VUERBVEVfU09SVEVEX0NPTExFQ1RJT046e1xuICAgICAgICAgICBpZihhY3Rpb24ucGF5bG9hZCkge1xuICAgICAgICAgICAgICAgIGxldCAgZ2FybWVudENvbGxlY3Rpb246R2FybWVudENvbGxlY3Rpb25Nb2RlbCA9IDxHYXJtZW50Q29sbGVjdGlvbk1vZGVsPnt9O1xuICAgICAgICAgICAgICAgIGNvbnN0IGdhcm1lbnRTb3J0ZWQ6R2FybWVudFNvcnRNb2RlbCA9IDxHYXJtZW50U29ydE1vZGVsPihhY3Rpb24ucGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgZ2FybWVudENvbGxlY3Rpb24uaWQgPSBnYXJtZW50U29ydGVkLmNvbGxlY3Rpb25JZDtcbiAgICAgICAgICAgICAgICBnYXJtZW50Q29sbGVjdGlvbi5wcm9kdWN0cyA9IFsuLi48R2FybWVudE1vZGVsW10+KGdhcm1lbnRTb3J0ZWQucHJvZHVjdHMpXTtcblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnICBVUERBVEVfU09SVEVEX0NPTExFQ1RJT04gZ2FybWVudENvbGxlY3Rpb24gJywgZ2FybWVudENvbGxlY3Rpb24gKVxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnICBiZWZvcmUgc3RhdGUuZW50aXRpZXNbIGdhcm1lbnRDb2xsZWN0aW9uLmlkXSAnLCBzdGF0ZS5lbnRpdGllc1sgZ2FybWVudENvbGxlY3Rpb24uaWRdIClcblxuXG4gICAgICAgICAgICAgc3RhdGUgPSAgT2JqZWN0LmFzc2lnbigge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJTZXQ6c3RhdGUuY3VycmVudFN1YlNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHM6IHN0YXRlLmlkcyAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50aXRpZXM6IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmVudGl0aWVzLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2FybWVudENvbGxlY3Rpb24uaWRdOiBnYXJtZW50Q29sbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xsZWN0aW9uSWQ6c3RhdGUuY3VycmVudENvbGxlY3Rpb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJyAgVVBEQVRFX1NPUlRFRF9DT0xMRUNUSU9OICBzdGF0ZSAuZW50aXRpZXNbIGdhcm1lbnRDb2xsZWN0aW9uLmlkXSAnLCAgc3RhdGUgLmVudGl0aWVzWyBnYXJtZW50Q29sbGVjdGlvbi5pZF0gKVxuXG4gICAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHN0YXRlXG5cbiAgICAgIH1cblxuICAgICAgY2FzZSBHYXJtZW50QWN0aW9uVHlwZXMuVVBEQVRFX0dBUk1FTlRfSU5fQ09MTEVDVElPTl9TVUNDRVNTOntcbiAgICAgICAgICAgaWYoYWN0aW9uLnBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBnYXJtZW50VXBkYXRlID0gPEdhcm1lbnRBZGRNb2RlbD4oYWN0aW9uLnBheWxvYWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZENvbGxlY3Rpb246R2FybWVudENvbGxlY3Rpb25Nb2RlbCA9IHN0YXRlLmVudGl0aWVzW2dhcm1lbnRVcGRhdGUuY29sbGVjdGlvbklkXTtcbiAgICAgICAgICAgICAgICBzb3J0ZWRDb2xsZWN0aW9uLnByb2R1Y3RzID0gc29ydGVkQ29sbGVjdGlvbi5wcm9kdWN0cy5tYXAoKHByb2R1Y3Q6R2FybWVudE1vZGVsKT0+e1xuICAgICAgICAgICAgICAgICAgICAgaWYocHJvZHVjdC5pZCA9PT0gZ2FybWVudFVwZGF0ZS5wcm9kdWN0LmlkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0ID0gZ2FybWVudFVwZGF0ZS5wcm9kdWN0O1xuICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2R1Y3Q7XG4gICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICBzdGF0ZS5lbnRpdGllcyA9ICBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZS5lbnRpdGllcywge1xuICAgICAgICAgICAgICAgICAgW3NvcnRlZENvbGxlY3Rpb24uaWRdOiBzb3J0ZWRDb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgIH1cbiAgICAgICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICB9XG5cbiAgICAgIGNhc2UgR2FybWVudEFjdGlvblR5cGVzLkFERF9HQVJNRU5UX1RPX0NPTExFQ1RJT05fU1VDQ0VTUzp7XG4gICAgICAgICAgIGlmKGFjdGlvbi5wYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2FybWVudFRvQWRkID0gPEdhcm1lbnRBZGRNb2RlbD4oYWN0aW9uLnBheWxvYWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25BZGRpbmdUbyA9IHN0YXRlLmVudGl0aWVzW2dhcm1lbnRUb0FkZC5jb2xsZWN0aW9uSWRdO1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25BZGRpbmdUby5wcm9kdWN0cy5wdXNoKGdhcm1lbnRUb0FkZC5wcm9kdWN0KTtcbiAgICAgICAgICAgICAgICAgc3RhdGUuZW50aXRpZXMgPSAgT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUuZW50aXRpZXMsIHtcbiAgICAgICAgICAgICAgICAgIFtjb2xsZWN0aW9uQWRkaW5nVG8uaWRdOiBjb2xsZWN0aW9uQWRkaW5nVG9cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgfVxuICAgICAgICAgICByZXR1cm4gc3RhdGU7XG5cbiAgICAgIH1cblxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfVxuICAgICAgfVxufVxuXG4vKipcbiAqIEJlY2F1c2UgdGhlIGRhdGEgc3RydWN0dXJlIGlzIGRlZmluZWQgd2l0aGluIHRoZSByZWR1Y2VyIGl0IGlzIG9wdGltYWwgdG9cbiAqIGxvY2F0ZSBvdXIgc2VsZWN0b3IgZnVuY3Rpb25zIGF0IHRoaXMgbGV2ZWwuIElmIHN0b3JlIGlzIHRvIGJlIHRob3VnaHQgb2ZcbiAqIGFzIGEgZGF0YWJhc2UsIGFuZCByZWR1Y2VycyB0aGUgdGFibGVzLCBzZWxlY3RvcnMgY2FuIGJlIGNvbnNpZGVyZWQgdGhlXG4gKiBxdWVyaWVzIGludG8gc2FpZCBkYXRhYmFzZS4gUmVtZW1iZXIgdG8ga2VlcCB5b3VyIHNlbGVjdG9ycyBzbWFsbCBhbmRcbiAqIGZvY3VzZWQgc28gdGhleSBjYW4gYmUgY29tYmluZWQgYW5kIGNvbXBvc2VkIHRvIGZpdCBlYWNoIHBhcnRpY3VsYXJcbiAqIHVzZS1jYXNlLlxuICovXG5cbmV4cG9ydCBjb25zdCBnZXRFbnRpdGllcyA9IChzdGF0ZTogU3RhdGUpID0+IHN0YXRlLmVudGl0aWVzO1xuXG5leHBvcnQgY29uc3QgZ2V0SWRzID0gKHN0YXRlOiBTdGF0ZSkgPT4gc3RhdGUuaWRzO1xuXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudENvbGxlY3Rpb25JZCA9IChzdGF0ZTogU3RhdGUpID0+IHN0YXRlLmN1cnJlbnRDb2xsZWN0aW9uSWQ7XG5cbmV4cG9ydCBjb25zdCBnZXRDdXJyZW50U3ViU2V0ID0gKHN0YXRlOiBTdGF0ZSkgPT4gc3RhdGUuY3VycmVudFN1YlNldDtcblxuZXhwb3J0IGNvbnN0IGdldEN1cnJlbnRHYXJtZW50Q29sbGVjdGlvbiAgPSBjcmVhdGVTZWxlY3RvcihnZXRFbnRpdGllcywgZ2V0Q3VycmVudENvbGxlY3Rpb25JZCwgKGVudGl0aWVzLCBjdXJyZW50Q29sbGVjdGlvbklkKSA9PiB7XG4gIHJldHVybiBlbnRpdGllc1tjdXJyZW50Q29sbGVjdGlvbklkXTtcbn0pO1xuXG5cbiJdfQ==

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var reselect_1 = require("reselect");
var fromRouter = require("@ngrx/router-store");
var env_config_1 = require("../../../shared-utils/app-env/env.config");
var compose_1 = require("@ngrx/core/compose");
var ngrx_store_freeze_1 = require("ngrx-store-freeze");
var store_1 = require("@ngrx/store");
var fromErrors = require("./error/error.reducer");
var fromPortal = require("./portal/portal.reducer");
var fromGarment = require("./garment/garment.reducer");
var reducers = {
    errors: fromErrors.reducer,
    portals: fromPortal.reducer,
    garments: fromGarment.reducer,
    router: fromRouter.routerReducer
};
var developmentReducer = compose_1.compose(ngrx_store_freeze_1.storeFreeze, store_1.combineReducers)(reducers);
var productionReducer = store_1.combineReducers(reducers);
function reducer(state, action) {
    if (env_config_1.Config.ENV === 'PROD') {
        return productionReducer(state, action);
    }
    else {
        return developmentReducer(state, action);
    }
}
exports.reducer = reducer;
exports.getErrorState = function (state) { return state.errors; };
exports.getErrorIds = reselect_1.createSelector(exports.getErrorState, fromErrors.getIds);
exports.getErrorEntities = reselect_1.createSelector(exports.getErrorState, fromErrors.getEntities);
exports.getGarmentsState = function (state) { return state.garments; };
exports.getGarmentIds = reselect_1.createSelector(exports.getGarmentsState, fromGarment.getIds);
exports.getCurrentCollectionId = reselect_1.createSelector(exports.getGarmentsState, fromGarment.getCurrentCollectionId);
exports.getGarmentEntities = reselect_1.createSelector(exports.getGarmentsState, fromGarment.getEntities);
exports.getCurrentGarmentCollection = reselect_1.createSelector(exports.getGarmentsState, fromGarment.getCurrentGarmentCollection);
exports.getPortalState = function (state) { return state.portals; };
exports.getViewablePerPage = reselect_1.createSelector(exports.getPortalState, fromPortal.getViewablePerPage);
exports.getCurrentPage = reselect_1.createSelector(exports.getPortalState, fromPortal.getCurrentPage);
exports.getSortType = reselect_1.createSelector(exports.getPortalState, fromPortal.getSortType);
exports.getSortBase = reselect_1.createSelector(exports.getPortalState, fromPortal.getSortBase);
exports.getSortState = reselect_1.createSelector(exports.getPortalState, fromPortal.getSortState);
exports.getCurrentSubSet = reselect_1.createSelector(exports.getCurrentGarmentCollection, exports.getCurrentPage, exports.getViewablePerPage, function (gcCollection, currentPage, viewablePerPage) {
    if (!gcCollection) {
        return [];
    }
    console.log('gcCollection =', gcCollection);
    if (gcCollection.products && gcCollection.products.length) {
        var pages = (gcCollection.products.length / viewablePerPage);
        var start = (currentPage - 1) * viewablePerPage;
        var end = (currentPage === pages) ?
            gcCollection.products.length - (pages * start) :
            viewablePerPage;
        gcCollection.products.slice(start, end);
        return gcCollection.products;
    }
    else {
        gcCollection.products = [];
        return gcCollection.products;
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kYXRhLWxheWVyL25ncngtZGF0YS9yZWR1Y2Vycy9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHFDQUEwQztBQUUxQywrQ0FBaUQ7QUFDakQsdUVBQWtFO0FBVWxFLDhDQUE2QztBQU83Qyx1REFBZ0Q7QUFVaEQscUNBQThDO0FBUzlDLGtEQUFvRDtBQUNwRCxvREFBc0Q7QUFDdEQsdURBQXlEO0FBc0J6RCxJQUFNLFFBQVEsR0FBRztJQUNmLE1BQU0sRUFBRSxVQUFVLENBQUMsT0FBTztJQUMxQixPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU87SUFDM0IsUUFBUSxFQUFFLFdBQVcsQ0FBQyxPQUFPO0lBQzdCLE1BQU0sRUFBRSxVQUFVLENBQUMsYUFBYTtDQUNqQyxDQUFDO0FBRUYsSUFBTSxrQkFBa0IsR0FBeUIsaUJBQU8sQ0FBQywrQkFBVyxFQUFFLHVCQUFlLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqRyxJQUFNLGlCQUFpQixHQUF5Qix1QkFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRTFFLGlCQUF3QixLQUFVLEVBQUUsTUFBVztJQUM3QyxFQUFFLENBQUMsQ0FBQyxtQkFBTSxDQUFDLEdBQUcsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMzQyxDQUFDO0FBQ0gsQ0FBQztBQU5ELDBCQU1DO0FBU1ksUUFBQSxhQUFhLEdBQUcsVUFBQyxLQUFZLElBQUssT0FBQSxLQUFLLENBQUMsTUFBTSxFQUFaLENBQVksQ0FBQztBQUUvQyxRQUFBLFdBQVcsR0FBRyx5QkFBYyxDQUFDLHFCQUFhLEVBQUUsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQy9ELFFBQUEsZ0JBQWdCLEdBQUkseUJBQWMsQ0FBQyxxQkFBYSxFQUFFLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUkxRSxRQUFBLGdCQUFnQixHQUFHLFVBQUMsS0FBWSxJQUFLLE9BQUEsS0FBSyxDQUFDLFFBQVEsRUFBZCxDQUFjLENBQUM7QUFFcEQsUUFBQSxhQUFhLEdBQUcseUJBQWMsQ0FBQyx3QkFBZ0IsRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFckUsUUFBQSxzQkFBc0IsR0FBRyx5QkFBYyxDQUFDLHdCQUFnQixFQUFFLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBRTlGLFFBQUEsa0JBQWtCLEdBQUkseUJBQWMsQ0FBQyx3QkFBZ0IsRUFBRSxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFaEYsUUFBQSwyQkFBMkIsR0FBSSx5QkFBYyxDQUFDLHdCQUFnQixFQUFFLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBV3pHLFFBQUEsY0FBYyxHQUFHLFVBQUMsS0FBWSxJQUFLLE9BQUEsS0FBSyxDQUFDLE9BQU8sRUFBYixDQUFhLENBQUM7QUFFakQsUUFBQSxrQkFBa0IsR0FBRyx5QkFBYyxDQUFDLHNCQUFjLEVBQUUsVUFBVSxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFFbkYsUUFBQSxjQUFjLEdBQUcseUJBQWMsQ0FBQyxzQkFBYyxFQUFFLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUUzRSxRQUFBLFdBQVcsR0FBRyx5QkFBYyxDQUFDLHNCQUFjLEVBQUUsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRXJFLFFBQUEsV0FBVyxHQUFHLHlCQUFjLENBQUMsc0JBQWMsRUFBRSxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFckUsUUFBQSxZQUFZLEdBQUcseUJBQWMsQ0FBQyxzQkFBYyxFQUFFLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUt2RSxRQUFBLGdCQUFnQixHQUFJLHlCQUFjLENBQUUsbUNBQTJCLEVBQzNCLHNCQUFjLEVBQ2QsMEJBQWtCLEVBQ25CLFVBQUUsWUFBWSxFQUNaLFdBQVcsRUFDWCxlQUFlO0lBQ2IsRUFBRSxDQUFBLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQSxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDWCxDQUFDO0lBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUMsQ0FBQTtJQUMzQyxFQUFFLENBQUEsQ0FBQyxZQUFZLENBQUMsUUFBUSxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBQztRQUNuRCxJQUFNLEtBQUssR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzdELElBQU0sS0FBSyxHQUFHLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxHQUFHLGVBQWUsQ0FBQztRQUNsRCxJQUFNLEdBQUcsR0FBRyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUM7WUFDakIsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUUsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFFO1lBQzlDLGVBQWUsQ0FBQztRQUNwQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFFLENBQUE7UUFDeEMsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7SUFDbEMsQ0FBQztJQUFBLElBQUksQ0FBQSxDQUFDO1FBQ0YsWUFBWSxDQUFDLFFBQVEsR0FBRSxFQUFFLENBQUM7UUFDMUIsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7SUFDakMsQ0FBQztBQUVELENBQUMsQ0FBRSxDQUFDIiwiZmlsZSI6ImFwcC9kYXRhLWxheWVyL25ncngtZGF0YS9yZWR1Y2Vycy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVNlbGVjdG9yIH0gZnJvbSAncmVzZWxlY3QnO1xuaW1wb3J0IHsgQWN0aW9uUmVkdWNlciB9IGZyb20gJ0BuZ3J4L3N0b3JlJztcbmltcG9ydCAqIGFzIGZyb21Sb3V0ZXIgZnJvbSAnQG5ncngvcm91dGVyLXN0b3JlJztcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC11dGlscy9hcHAtZW52L2Vudi5jb25maWcnO1xuXG4vKipcbiAqIFRoZSBjb21wb3NlIGZ1bmN0aW9uIGlzIG9uZSBvZiBvdXIgbW9zdCBoYW5keSB0b29scy4gSW4gYmFzaWMgdGVybXMsIHlvdSBnaXZlXG4gKiBpdCBhbnkgbnVtYmVyIG9mIGZ1bmN0aW9ucyBhbmQgaXQgcmV0dXJucyBhIGZ1bmN0aW9uLiBUaGlzIG5ldyBmdW5jdGlvblxuICogdGFrZXMgYSB2YWx1ZSBhbmQgY2hhaW5zIGl0IHRocm91Z2ggZXZlcnkgY29tcG9zZWQgZnVuY3Rpb24sIHJldHVybmluZ1xuICogdGhlIG91dHB1dC5cbiAqXG4gKiBNb3JlOiBodHRwczovL2RyYm9vbGVhbi5naXRib29rcy5pby9tb3N0bHktYWRlcXVhdGUtZ3VpZGUvY29udGVudC9jaDUuaHRtbFxuICovXG5pbXBvcnQgeyBjb21wb3NlIH0gZnJvbSAnQG5ncngvY29yZS9jb21wb3NlJztcblxuLyoqXG4gKiBzdG9yZUZyZWV6ZSBwcmV2ZW50cyBzdGF0ZSBmcm9tIGJlaW5nIG11dGF0ZWQuIFdoZW4gbXV0YXRpb24gb2NjdXJzLCBhblxuICogZXhjZXB0aW9uIHdpbGwgYmUgdGhyb3duLiBUaGlzIGlzIHVzZWZ1bCBkdXJpbmcgZGV2ZWxvcG1lbnQgbW9kZSB0b1xuICogZW5zdXJlIHRoYXQgbm9uZSBvZiB0aGUgcmVkdWNlcnMgYWNjaWRlbnRhbGx5IG11dGF0ZXMgdGhlIHN0YXRlLlxuICovXG5pbXBvcnQgeyBzdG9yZUZyZWV6ZSB9IGZyb20gJ25ncngtc3RvcmUtZnJlZXplJztcblxuLyoqXG4gKiBjb21iaW5lUmVkdWNlcnMgaXMgYW5vdGhlciB1c2VmdWwgbWV0YXJlZHVjZXIgdGhhdCB0YWtlcyBhIG1hcCBvZiByZWR1Y2VyXG4gKiBmdW5jdGlvbnMgYW5kIGNyZWF0ZXMgYSBuZXcgcmVkdWNlciB0aGF0IGdhdGhlcnMgdGhlIHZhbHVlc1xuICogb2YgZWFjaCByZWR1Y2VyIGFuZCBzdG9yZXMgdGhlbSB1c2luZyB0aGUgcmVkdWNlcidzIGtleS4gVGhpbmsgb2YgaXRcbiAqIGFsbW9zdCBsaWtlIGEgZGF0YWJhc2UsIHdoZXJlIGV2ZXJ5IHJlZHVjZXIgaXMgYSB0YWJsZSBpbiB0aGUgZGIuXG4gKlxuICogTW9yZTogaHR0cHM6Ly9lZ2doZWFkLmlvL2xlc3NvbnMvamF2YXNjcmlwdC1yZWR1eC1pbXBsZW1lbnRpbmctY29tYmluZXJlZHVjZXJzLWZyb20tc2NyYXRjaFxuICovXG5pbXBvcnQgeyBjb21iaW5lUmVkdWNlcnMgfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5cblxuLyoqXG4gKiBFdmVyeSByZWR1Y2VyIG1vZHVsZSdzIGRlZmF1bHQgZXhwb3J0IGlzIHRoZSByZWR1Y2VyIGZ1bmN0aW9uIGl0c2VsZi4gSW5cbiAqIGFkZGl0aW9uLCBlYWNoIG1vZHVsZSBzaG91bGQgZXhwb3J0IGEgdHlwZSBvciBpbnRlcmZhY2UgdGhhdCBkZXNjcmliZXNcbiAqIHRoZSBzdGF0ZSBvZiB0aGUgcmVkdWNlciBwbHVzIGFueSBzZWxlY3RvciBmdW5jdGlvbnMuIFRoZSBgKiBhc2BcbiAqIG5vdGF0aW9uIHBhY2thZ2VzIHVwIGFsbCBvZiB0aGUgZXhwb3J0cyBpbnRvIGEgc2luZ2xlIG9iamVjdC5cbiAqL1xuaW1wb3J0ICogYXMgZnJvbUVycm9ycyBmcm9tICcuL2Vycm9yL2Vycm9yLnJlZHVjZXInO1xuaW1wb3J0ICogYXMgZnJvbVBvcnRhbCBmcm9tICcuL3BvcnRhbC9wb3J0YWwucmVkdWNlcic7XG5pbXBvcnQgKiBhcyBmcm9tR2FybWVudCBmcm9tICcuL2dhcm1lbnQvZ2FybWVudC5yZWR1Y2VyJztcblxuXG4vKipcbiAqIEFzIG1lbnRpb25lZCwgd2UgdHJlYXQgZWFjaCByZWR1Y2VyIGxpa2UgYSB0YWJsZSBpbiBhIGRhdGFiYXNlLiBUaGlzIG1lYW5zXG4gKiBvdXIgdG9wIGxldmVsIHN0YXRlIGludGVyZmFjZSBpcyBqdXN0IGEgbWFwIG9mIGtleXMgdG8gaW5uZXIgc3RhdGUgdHlwZXMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGUge1xuICBlcnJvcnM6IGZyb21FcnJvcnMuU3RhdGU7XG4gIHBvcnRhbHM6IGZyb21Qb3J0YWwuU3RhdGU7XG4gIGdhcm1lbnRzOiBmcm9tR2FybWVudC5TdGF0ZTtcbiAgcm91dGVyOiBmcm9tUm91dGVyLlJvdXRlclN0YXRlO1xufVxuXG5cbi8qKlxuICogQmVjYXVzZSBtZXRhcmVkdWNlcnMgdGFrZSBhIHJlZHVjZXIgZnVuY3Rpb24gYW5kIHJldHVybiBhIG5ldyByZWR1Y2VyLFxuICogd2UgY2FuIHVzZSBvdXIgY29tcG9zZSBoZWxwZXIgdG8gY2hhaW4gdGhlbSB0b2dldGhlci4gSGVyZSB3ZSBhcmVcbiAqIHVzaW5nIGNvbWJpbmVSZWR1Y2VycyB0byBtYWtlIG91ciB0b3AgbGV2ZWwgcmVkdWNlciwgYW5kIHRoZW5cbiAqIHdyYXBwaW5nIHRoYXQgaW4gc3RvcmVMb2dnZXIuIFJlbWVtYmVyIHRoYXQgY29tcG9zZSBhcHBsaWVzXG4gKiB0aGUgcmVzdWx0IGZyb20gcmlnaHQgdG8gbGVmdC5cbiAqL1xuY29uc3QgcmVkdWNlcnMgPSB7XG4gIGVycm9yczogZnJvbUVycm9ycy5yZWR1Y2VyLFxuICBwb3J0YWxzOiBmcm9tUG9ydGFsLnJlZHVjZXIsXG4gIGdhcm1lbnRzOiBmcm9tR2FybWVudC5yZWR1Y2VyLFxuICByb3V0ZXI6IGZyb21Sb3V0ZXIucm91dGVyUmVkdWNlclxufTtcblxuY29uc3QgZGV2ZWxvcG1lbnRSZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPFN0YXRlPiA9IGNvbXBvc2Uoc3RvcmVGcmVlemUsIGNvbWJpbmVSZWR1Y2VycykocmVkdWNlcnMpO1xuY29uc3QgcHJvZHVjdGlvblJlZHVjZXI6IEFjdGlvblJlZHVjZXI8U3RhdGU+ID0gY29tYmluZVJlZHVjZXJzKHJlZHVjZXJzKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlZHVjZXIoc3RhdGU6IGFueSwgYWN0aW9uOiBhbnkpIHtcbiAgaWYgKENvbmZpZy5FTlYgPT09ICdQUk9EJykge1xuICAgIHJldHVybiBwcm9kdWN0aW9uUmVkdWNlcihzdGF0ZSwgYWN0aW9uKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZGV2ZWxvcG1lbnRSZWR1Y2VyKHN0YXRlLCBhY3Rpb24pO1xuICB9XG59XG5cblxuXG5cbi8qKlxuICogSnVzdCBsaWtlIHdpdGggdGhlIGJvb2tzIHNlbGVjdG9ycywgd2UgYWxzbyBoYXZlIHRvIGNvbXBvc2UgdGhlIHNlYXJjaFxuICogcmVkdWNlcidzIGFuZCBjb2xsZWN0aW9uIHJlZHVjZXIncyBzZWxlY3RvcnMuXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRFcnJvclN0YXRlID0gKHN0YXRlOiBTdGF0ZSkgPT4gc3RhdGUuZXJyb3JzO1xuXG5leHBvcnQgY29uc3QgZ2V0RXJyb3JJZHMgPSBjcmVhdGVTZWxlY3RvcihnZXRFcnJvclN0YXRlLCBmcm9tRXJyb3JzLmdldElkcyk7XG5leHBvcnQgY29uc3QgZ2V0RXJyb3JFbnRpdGllcyAgPSBjcmVhdGVTZWxlY3RvcihnZXRFcnJvclN0YXRlLCBmcm9tRXJyb3JzLmdldEVudGl0aWVzKTtcblxuXG5cbmV4cG9ydCBjb25zdCBnZXRHYXJtZW50c1N0YXRlID0gKHN0YXRlOiBTdGF0ZSkgPT4gc3RhdGUuZ2FybWVudHM7XG5cbmV4cG9ydCBjb25zdCBnZXRHYXJtZW50SWRzID0gY3JlYXRlU2VsZWN0b3IoZ2V0R2FybWVudHNTdGF0ZSwgZnJvbUdhcm1lbnQuZ2V0SWRzKTtcblxuZXhwb3J0IGNvbnN0IGdldEN1cnJlbnRDb2xsZWN0aW9uSWQgPSBjcmVhdGVTZWxlY3RvcihnZXRHYXJtZW50c1N0YXRlLCBmcm9tR2FybWVudC5nZXRDdXJyZW50Q29sbGVjdGlvbklkKTtcblxuZXhwb3J0IGNvbnN0IGdldEdhcm1lbnRFbnRpdGllcyAgPSBjcmVhdGVTZWxlY3RvcihnZXRHYXJtZW50c1N0YXRlLCBmcm9tR2FybWVudC5nZXRFbnRpdGllcyk7XG5cbmV4cG9ydCBjb25zdCBnZXRDdXJyZW50R2FybWVudENvbGxlY3Rpb24gID0gY3JlYXRlU2VsZWN0b3IoZ2V0R2FybWVudHNTdGF0ZSwgZnJvbUdhcm1lbnQuZ2V0Q3VycmVudEdhcm1lbnRDb2xsZWN0aW9uKTtcblxuXG5cblxuXG5cblxuLyoqXG4gKiBwb3J0YWwgUmVkdWNlcnNcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFBvcnRhbFN0YXRlID0gKHN0YXRlOiBTdGF0ZSkgPT4gc3RhdGUucG9ydGFscztcblxuZXhwb3J0IGNvbnN0IGdldFZpZXdhYmxlUGVyUGFnZSA9IGNyZWF0ZVNlbGVjdG9yKGdldFBvcnRhbFN0YXRlLCBmcm9tUG9ydGFsLmdldFZpZXdhYmxlUGVyUGFnZSk7XG5cbmV4cG9ydCBjb25zdCBnZXRDdXJyZW50UGFnZSA9IGNyZWF0ZVNlbGVjdG9yKGdldFBvcnRhbFN0YXRlLCBmcm9tUG9ydGFsLmdldEN1cnJlbnRQYWdlKTtcblxuZXhwb3J0IGNvbnN0IGdldFNvcnRUeXBlID0gY3JlYXRlU2VsZWN0b3IoZ2V0UG9ydGFsU3RhdGUsIGZyb21Qb3J0YWwuZ2V0U29ydFR5cGUpO1xuXG5leHBvcnQgY29uc3QgZ2V0U29ydEJhc2UgPSBjcmVhdGVTZWxlY3RvcihnZXRQb3J0YWxTdGF0ZSwgZnJvbVBvcnRhbC5nZXRTb3J0QmFzZSk7XG5cbmV4cG9ydCBjb25zdCBnZXRTb3J0U3RhdGUgPSBjcmVhdGVTZWxlY3RvcihnZXRQb3J0YWxTdGF0ZSwgZnJvbVBvcnRhbC5nZXRTb3J0U3RhdGUpO1xuXG5cblxuXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudFN1YlNldCA9ICBjcmVhdGVTZWxlY3RvciggZ2V0Q3VycmVudEdhcm1lbnRDb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEN1cnJlbnRQYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFZpZXdhYmxlUGVyUGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggZ2NDb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld2FibGVQZXJQYWdlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFnY0NvbGxlY3Rpb24pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnY0NvbGxlY3Rpb24gPScsIGdjQ29sbGVjdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihnY0NvbGxlY3Rpb24ucHJvZHVjdHMgJiYgZ2NDb2xsZWN0aW9uLnByb2R1Y3RzLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhZ2VzID0gKGdjQ29sbGVjdGlvbi5wcm9kdWN0cy5sZW5ndGgvdmlld2FibGVQZXJQYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSAoY3VycmVudFBhZ2UgLSAxKSAqIHZpZXdhYmxlUGVyUGFnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gKGN1cnJlbnRQYWdlID09PSBwYWdlcyk/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdjQ29sbGVjdGlvbi5wcm9kdWN0cy5sZW5ndGggLShwYWdlcyAqIHN0YXJ0ICk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdhYmxlUGVyUGFnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdjQ29sbGVjdGlvbi5wcm9kdWN0cy5zbGljZShzdGFydCwgZW5kIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnY0NvbGxlY3Rpb24ucHJvZHVjdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdjQ29sbGVjdGlvbi5wcm9kdWN0cz0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnY0NvbGxlY3Rpb24ucHJvZHVjdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSApOyJdfQ==
